<style>
    :root {
        --primary: #4361ee;
        --primary-light: #eef2ff;
        --primary-dark: #3a56d4;
        --secondary: #06d6a0;
        --light: #f8f9fa;
        --dark: #212529;
        --gray: #6c757d;
        --border: #dee2e6;
        --radius: 8px;
        --shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
        background-color: #f5f7fb;
        color: var(--dark);
        line-height: 1.5;
        font-size: 14px;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    header {
        background: white;
        box-shadow: var(--shadow);
        border-radius: var(--radius);
        padding: 20px;
        margin-bottom: 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .logo-icon {
        width: 40px;
        height: 40px;
        background: var(--primary);
        border-radius: var(--radius);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
    }

    .logo-text {
        font-size: 22px;
        font-weight: 700;
        color: var(--dark);
    }

    .user-info {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 14px;
        color: var(--gray);
    }

    .user-avatar {
        width: 36px;
        height: 36px;
        background: var(--primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 16px;
    }

    .content-area {
        background: white;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 24px;
    }

    .page-header {
        margin-bottom: 20px;
    }

        .page-header h1 {
            font-size: 26px;
            color: var(--dark);
            margin-bottom: 6px;
            font-weight: 700;
        }

        .page-header p {
            color: var(--gray);
            font-size: 15px;
        }

    .btn {
        background: white;
        color: var(--dark);
        border: 1px solid var(--border);
        padding: 8px 14px;
        border-radius: var(--radius);
        font-size: 13px;
        cursor: pointer;
        transition: all 0.15s ease;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-weight: 500;
    }

        .btn:hover {
            background: #f8f9fa;
            border-color: var(--gray);
        }

    .btn-primary {
        background: var(--primary);
        color: white;
        border: none;
    }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

    .btn-success {
        background: var(--secondary);
        color: white;
        border: none;
    }

        .btn-success:hover {
            background: #05c290;
        }

    .card {
        background: white;
        border-radius: var(--radius);
        padding: 16px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
        margin-bottom: 16px;
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
    }

    .card-title {
        font-size: 16px;
        font-weight: 700;
        color: var(--dark);
    }

    .assignment-methods {
        background: var(--light);
        border-radius: var(--radius);
        padding: 16px;
        margin-bottom: 20px;
    }

    .method-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
    }

    .method-tab {
        padding: 10px 16px;
        border-radius: var(--radius);
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.15s ease;
        border: 1px solid transparent;
        display: flex;
        align-items: center;
        gap: 8px;
    }

        .method-tab:hover {
            background: white;
            border-color: var(--border);
        }

        .method-tab.active {
            background: white;
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: var(--shadow);
        }

    .method-content {
        background: white;
        border-radius: var(--radius);
        padding: 16px;
        border: 1px solid var(--border);
    }

    .upload-area {
        border: 2px dashed var(--border);
        border-radius: var(--radius);
        padding: 20px;
        text-align: center;
        transition: all 0.15s ease;
        cursor: pointer;
        background: var(--light);
        margin-bottom: 12px;
    }

        .upload-area:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .upload-area.dragover {
            background: var(--primary-light);
            border-color: var(--primary);
        }

    .upload-icon {
        width: 36px;
        height: 36px;
        margin: 0 auto 8px;
        background: var(--primary);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: white;
    }

    .upload-text {
        font-size: 14px;
        color: var(--dark);
        margin-bottom: 4px;
        font-weight: 600;
    }

    .upload-subtext {
        color: var(--gray);
        font-size: 12px;
    }

    .file-input {
        display: none;
    }

    .download-template {
        text-align: center;
        margin-bottom: 12px;
        padding: 12px;
        background: var(--light);
        border-radius: var(--radius);
        border: 1px solid var(--border);
    }

    .download-link {
        color: var(--primary);
        text-decoration: none;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
        transition: all 0.15s ease;
    }

        .download-link:hover {
            color: var(--primary-dark);
        }

    .form-group {
        margin-bottom: 12px;
    }

    .form-label {
        display: block;
        margin-bottom: 6px;
        color: var(--dark);
        font-weight: 600;
        font-size: 13px;
    }

    .form-input, .form-select {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        font-size: 13px;
        color: var(--dark);
        transition: all 0.15s ease;
    }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.1);
        }

    .table-container {
        overflow-x: auto;
        border-radius: var(--radius);
        border: 1px solid var(--border);
        margin-top: 16px;
        max-height: 500px;
        overflow-y: auto;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
    }

    thead {
        background: var(--light);
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        z-index: 10;
    }

    th {
        padding: 10px 12px;
        text-align: left;
        font-weight: 600;
        color: var(--gray);
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        background: var(--light);
    }

    td {
        padding: 10px 12px;
        border-bottom: 1px solid var(--border);
        color: var(--dark);
    }

    tbody tr {
        transition: background 0.1s ease;
    }

        tbody tr:hover {
            background: #f8f9fa;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

    .group-select {
        padding: 6px 10px;
        border: 1px solid var(--border);
        border-radius: 6px;
        font-size: 13px;
        width: 100%;
        background: white;
    }

    .alert {
        padding: 12px 16px;
        border-radius: var(--radius);
        margin-bottom: 16px;
        display: none;
        animation: slideDown 0.2s ease;
        border: 1px solid;
        font-size: 13px;
    }

        .alert.success {
            background: #f0fdf4;
            color: #166534;
            border-color: #bbf7d0;
        }

        .alert.error {
            background: #fef2f2;
            color: #991b1b;
            border-color: #fecaca;
        }

        .alert.active {
            display: flex;
            align-items: center;
            gap: 8px;
        }

    @@keyframes slideDown {
        from

    {
        transform: translateY(-8px);
        opacity: 0;
    }

    to {
        transform: translateY(0);
        opacity: 1;
    }

    }

    .status-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        margin: 2px;
    }

    .status-assigned {
        background: #f0fdf4;
        color: #166534;
        border: 1px solid #bbf7d0;
    }

    .status-unassigned {
        background: #fef2f2;
        color: #991b1b;
        border: 1px solid #fecaca;
    }

    .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 16px;
        flex-wrap: wrap;
    }

    .multi-select {
        min-height: 100px;
        padding: 8px;
    }

        .multi-select option {
            padding: 6px 8px;
            margin: 2px 0;
            border-radius: 4px;
        }

            .multi-select option:checked {
                background: var(--primary-light);
                color: var(--primary);
            }

    .groups-overview {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 12px;
        margin-top: 16px;
    }

    .group-card {
        background: white;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 12px;
        box-shadow: var(--shadow);
    }

    .group-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--border);
    }

    .group-name {
        font-size: 14px;
        font-weight: 700;
        color: var(--dark);
    }

    .group-count {
        background: var(--primary-light);
        color: var(--primary);
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 700;
    }

    .group-members {
        color: var(--gray);
        font-size: 12px;
        line-height: 1.4;
        max-height: 80px;
        overflow-y: auto;
    }

    /* Large dataset optimizations */
    .controls-bar {
        display: flex;
        gap: 12px;
        margin-bottom: 16px;
        flex-wrap: wrap;
        align-items: center;
    }

    .search-box {
        flex: 1;
        min-width: 200px;
        position: relative;
    }

    .search-input {
        width: 100%;
        padding: 8px 12px 8px 36px;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        font-size: 13px;
    }

    .search-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray);
    }

    .filter-group {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .pagination {
        display: flex;
        gap: 6px;
        align-items: center;
        margin-top: 16px;
        justify-content: center;
    }

    .pagination-btn {
        padding: 6px 10px;
        border: 1px solid var(--border);
        border-radius: 4px;
        background: white;
        cursor: pointer;
        font-size: 12px;
    }

        .pagination-btn:hover:not(:disabled) {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

    .pagination-info {
        font-size: 12px;
        color: var(--gray);
        margin: 0 12px;
    }

    .stats-bar {
        display: flex;
        gap: 16px;
        margin-bottom: 16px;
        flex-wrap: wrap;
    }

    .stat-item {
        display: flex;
        flex-direction: column;
        padding: 12px;
        background: var(--light);
        border-radius: var(--radius);
        min-width: 120px;
    }

    .stat-value {
        font-size: 20px;
        font-weight: 700;
        color: var(--primary);
    }

    .stat-label {
        font-size: 12px;
        color: var(--gray);
    }

    .batch-actions {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
        flex-wrap: wrap;
    }

    /* Modal Styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
        animation: fadeIn 0.3s ease;
    }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

    @@keyframes fadeIn {
        from

    {
        opacity: 0;
    }

    to {
        opacity: 1;
    }

    }

    @@keyframes slideUp {
        from

    {
        transform: translateY(20px);
        opacity: 0;
    }

    to {
        transform: translateY(0);
        opacity: 1;
    }

    }

    .modal-content {
        background: white;
        border-radius: 12px;
        padding: 0;
        max-width: 600px;
        width: 90%;
        position: relative;
        animation: slideUp 0.3s ease;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    .modal-header {
        padding: 20px 25px;
        border-bottom: 1px solid var(--border);
    }

        .modal-header h2 {
            color: var(--dark);
            font-size: 22px;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .modal-header p {
            color: var(--gray);
            font-size: 14px;
        }

    .close-btn {
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 24px;
        color: var(--gray);
        cursor: pointer;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        transition: all 0.15s ease;
        background: transparent;
    }

        .close-btn:hover {
            background: #f1f5f9;
            color: var(--dark);
        }

    .modal-body {
        padding: 25px;
    }

    @@media (max-width: 768px) {
        .action-buttons

    {
        flex-direction: column;
    }

    .groups-overview {
        grid-template-columns: 1fr;
    }

    .controls-bar {
        flex-direction: column;
        align-items: stretch;
    }

    .stats-bar {
        justify-content: center;
    }

    .modal-content {
        width: 95%;
        margin: 20px;
    }

    }</style>
     

    <div class="alert" id="alertBox"></div>

    <div class="page-header">
        <h1>Bulk Group Assignment</h1>
        <p>Efficiently manage large datasets with advanced filtering and batch operations</p>
    </div>

    <!-- Statistics Bar -->
    <div class="stats-bar">
        <div class="stat-item">
            <div class="stat-value" id="totalParticipants">0</div>
            <div class="stat-label">Total Participants</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="assignedParticipants">0</div>
            <div class="stat-label">Assigned</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="unassignedParticipants">0</div>
            <div class="stat-label">Unassigned</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="totalGroups">0</div>
            <div class="stat-label">Groups</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="totalAssignments">0</div>
            <div class="stat-label">Assignments</div>
        </div>
    </div>

    <div class="assignment-methods">
        <div class="method-tabs">
            <div class="method-tab active" id="excelTab" onclick="openUploadModal()">
                <span>📊</span> Bulk Assign Groups
            </div>
            <div class="method-tab" id="onscreenTab" style="display:none;" onclick="selectMethod('onscreen')">
                <span>🖥️</span> On-Screen
            </div>
        </div>

        <div class="method-content" style="display:none;">
            <!-- On-Screen Assignment Section -->
            <div id="onscreenSection">
                <div class="form-group">
                    <label class="form-label">Create New Groups</label>
                    <input type="text" class="form-input" id="newGroupsInput" placeholder="Enter group names separated by commas">
                </div>
                <button class="btn btn-success" onclick="createNewGroups()" style="width: 100%; margin-bottom: 12px;">
                    <span>➕</span> Create Groups
                </button>
                <div class="form-group">
                    <label class="form-label">Assign Groups to All Participants</label>
                    <select class="form-select multi-select" id="existingGroupSelect" multiple>
                        <!-- Groups will be populated here -->
                    </select>
                </div>
                <button class="btn btn-primary" onclick="assignSelectedGroups()" style="width: 100%;">
                    <span>📝</span> Assign Groups to All
                </button>
            </div>
        </div>
    </div>

    <!-- Batch Actions -->
    <div class="batch-actions">
        <button class="btn btn-primary" onclick="autoAssignGroups()">
            <span>🎲</span> Auto Assign Groups
        </button>
        <button class="btn" onclick="clearAssignments()">
            <span>🗑️</span> Clear All Assignments
        </button>
        <button class="btn" onclick="exportToExcel()">
            <span>📤</span> Export to Excel
        </button>
        <button class="btn" onclick="selectUnassigned()">
            <span>🔍</span> Select Unassigned
        </button>
    <button class="btn btn-primary" onclick="assignToSelected()">
        <span>📝</span> Lock Event

    </button> <button class="btn btn-primary" onclick="assignToSelected()">
        <span>📝</span> unlock Event
    </button>
</div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">Groups Overview</div>
            <div class="status-badge status-unassigned" id="unassignedCount">0 unassigned</div>
        </div>
        <div class="groups-overview" id="groupsOverview">
            <!-- Groups will be populated here -->
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">Assignment Table</div>
            <div class="status-badge status-assigned" id="totalAssignmentCount">0 assignments</div>
        </div>

        <!-- Controls Bar -->
        <div class="controls-bar">
            <div class="search-box">
                <span class="search-icon">🔍</span>
                <input type="text" class="search-input" id="searchInput" placeholder="Search participants...">
            </div>
            <div class="filter-group">
                <label>Filter by:</label>
                <select class="form-select" id="groupFilter" style="min-width: 150px;">
                    <option value="">All Groups</option>
                </select>
                <select class="form-select" id="assignmentFilter" style="min-width: 150px;">
                    <option value="all">All Participants</option>
                    <option value="assigned">Assigned Only</option>
                    <option value="unassigned">Unassigned Only</option>
                </select>
            </div>
        </div>

        <div class="table-container" id="tableContainer">
            <table id="assignmentTable">
                <thead>
                    <tr>
                        <th style="width: 30px;">
                            <input type="checkbox" id="selectAll">
                        </th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Groups</th>
                        <th>Assign Groups</th>
                    </tr>
                </thead>
                <tbody id="assignmentBody">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination">
            <button class="pagination-btn" id="firstPage" onclick="goToPage(1)">«</button>
            <button class="pagination-btn" id="prevPage" onclick="goToPage(currentPage - 1)">‹</button>
            <span class="pagination-info" id="pageInfo">Page 1 of 1</span>
            <button class="pagination-btn" id="nextPage" onclick="goToPage(currentPage + 1)">›</button>
            <button class="pagination-btn" id="lastPage" onclick="goToPage(totalPages)">»</button>
        </div>

        <div class="action-buttons">
            <button class="btn btn-primary" onclick="assignToSelected()">
                <span>📝</span> Assign to Selected
            </button>
        <button class="btn btn-primary" onclick="assignToSelected()">
            <span>📝</span> Lock Event

        </button> <button class="btn btn-primary" onclick="assignToSelected()">
            <span>📝</span> unlock Event
        </button>

        <select class="form-select" id="batchGroupSelect" style="min-width: 200px;">
                <option value="">Select groups to assign</option>
            </select>
        </div>
    </div>

               <!-- Excel Upload Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeUploadModal()">&times;</span>
            
            <div class="modal-header">
                <h2>Upload Excel File</h2>
                <p>Import participant data with group assignments</p>
            </div>

            <div class="modal-body">
                <div class="download-template">
                    <a href="#" class="download-link" id="downloadTemplate">
                        <span>📥</span> Download Excel Template
                    </a>
                </div>

                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">📤</div>
                    <div class="upload-text">Drop Excel File Here</div>
                    <div class="upload-subtext">Supports files with thousands of participants</div>
                    <input type="file" id="fileInput" class="file-input" accept=".xlsx, .xls">
                </div>

                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()" style="width: 100%; margin-bottom: 16px;">
                    <span>📁</span> Browse Files
                </button>

                <div class="card">
                    <div class="card-title" style="margin-bottom: 12px;">File Requirements</div>
                    <ul style="color: var(--gray); font-size: 13px; line-height: 1.6; padding-left: 20px;">
                        <li>Excel files (.xlsx, .xls) are supported</li>
                        <li>File must include columns: <strong>Name</strong>, <strong>Email</strong>, and <strong>Groups</strong></li>
                        <li>Groups column should contain comma-separated group names</li>
                        <li>First row should contain column headers</li>
                        <li>Maximum file size: 10MB</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Generate large dataset for testing
        function generateLargeDataset(count = 1000) {
            const firstNames = ['John', 'Jane', 'Robert', 'Emily', 'Michael', 'Sarah', 'David', 'Lisa', 'James', 'Maria', 'William', 'Linda'];
            const lastNames = ['Doe', 'Smith', 'Johnson', 'Davis', 'Wilson', 'Brown', 'Miller', 'Taylor', 'Anderson', 'Thomas', 'Jackson', 'White'];
            const domains = ['example.com', 'test.org', 'demo.net', 'sample.co'];
            
            const participants = [];
            for (let i = 0; i < count; i++) {
                const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                const domain = domains[Math.floor(Math.random() * domains.length)];
                
                // Randomly assign 0-3 groups
                const groupCount = Math.floor(Math.random() * 4);
                const assignedGroups = [];
                for (let j = 0; j < groupCount; j++) {
                    const group = `Group ${String.fromCharCode(65 + Math.floor(Math.random() * 6))}`;
                    if (!assignedGroups.includes(group)) {
                        assignedGroups.push(group);
                    }
                }
                
                participants.push({
                    Name: `${firstName} ${lastName}`,
                    Email: `${firstName.toLowerCase()}.${lastName.toLowerCase()}.${domain}`,
                    Groups: assignedGroups
                });
            }
            
            return participants;
        }

        // Sample data with multi-group support
        let participants = generateLargeDataset(500); // Start with 500 for better performance
        let groups = ['Group A', 'Group B', 'Group C', 'Group D', 'Group E', 'Group F'];
        let currentPage = 1;
        const pageSize = 50;
        let totalPages = 1;
        let filteredParticipants = [];

        // DOM elements
        const uploadModal = document.getElementById('uploadModal');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const alertBox = document.getElementById('alertBox');

        // Initialize the application
        function init() {
            setupEventListeners();
            updateFilteredParticipants();
            updatePagination();
            renderCurrentPage();
            updateGroupSelect();
            updateGroupsOverview();
            updateStats();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Upload area interactions
            uploadArea.addEventListener('click', () => fileInput.click());

            // Drag and drop for upload area
            setupDragAndDrop(uploadArea, fileInput);

            // File input change handler
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });

            // Template download
            document.getElementById('downloadTemplate').addEventListener('click', (e) => {
                e.preventDefault();
                downloadTemplate();
            });

            // Search functionality
            document.getElementById('searchInput').addEventListener('input', (e) => {
                updateFilteredParticipants();
                updatePagination();
                renderCurrentPage();
            });

            // Filter functionality
            document.getElementById('groupFilter').addEventListener('change', () => {
                updateFilteredParticipants();
                updatePagination();
                renderCurrentPage();
            });

            document.getElementById('assignmentFilter').addEventListener('change', () => {
                updateFilteredParticipants();
                updatePagination();
                renderCurrentPage();
            });

            // Select all checkbox
            document.getElementById('selectAll').addEventListener('change', (e) => {
                const checkboxes = document.querySelectorAll('.participant-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = e.target.checked;
                });
            });

            // Modal close on backdrop click
            uploadModal.addEventListener('click', (e) => {
                if (e.target === uploadModal) {
                    closeUploadModal();
                }
            });
        }

        // Set up drag and drop
        function setupDragAndDrop(uploadArea, fileInput) {
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                if (e.dataTransfer.files.length > 0) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileUpload(e.dataTransfer.files[0]);
                }
            });
        }

        // Modal functions
        function openUploadModal() {
            uploadModal.classList.add('active');
            // Set Excel tab as active
            document.getElementById('excelTab').classList.add('active');
            document.getElementById('onscreenTab').classList.remove('active');
        }

        function closeUploadModal() {
            uploadModal.classList.remove('active');
        }

        // Handle method selection
        function selectMethod(method) {
            // Update UI
            document.getElementById('excelTab').classList.toggle('active', method === 'excel');
            document.getElementById('onscreenTab').classList.toggle('active', method === 'onscreen');
            
            if (method === 'excel') {
                openUploadModal();
            }
        }

        // Handle file upload
        function handleFileUpload(file) {
            showAlert('Processing large file...', 'success');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    // Check if the file has required columns
                    if (!jsonData[0] || (!jsonData[0].hasOwnProperty('Groups') && !jsonData[0].hasOwnProperty('GROUPS'))) {
                        showAlert('Excel file must contain a "Groups" column', 'error');
                        return;
                    }
                    
                    // Update participants with group assignments
                    participants = jsonData.map(row => {
                        // Handle case-insensitive column names
                        const groupsValue = row.Groups || row.GROUPS || row.groups || '';
                        
                        // Convert comma-separated string to array
                        let groupsArray = [];
                        if (typeof groupsValue === 'string') {
                            groupsArray = groupsValue.split(',').map(g => g.trim()).filter(Boolean);
                        } else if (Array.isArray(groupsValue)) {
                            groupsArray = groupsValue;
                        }
                        
                        return {
                            Name: row.Name || row.NAME || '',
                            Email: row.Email || row.EMAIL || '',
                            Groups: groupsArray
                        };
                    });
                    
                    // Extract unique groups from all participants
                    updateGroupsFromParticipants();
                    
                    updateFilteredParticipants();
                    updatePagination();
                    renderCurrentPage();
                    updateGroupSelect();
                    updateGroupsOverview();
                    updateStats();
                    closeUploadModal();
                    showAlert(`Loaded ${participants.length} participants successfully!`, 'success');
                } catch (error) {
                    showAlert('Error reading file: ' + error.message, 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Show alert message
        function showAlert(message, type) {
            alertBox.textContent = message;
            alertBox.className = `alert ${type} active`;
            setTimeout(() => {
                alertBox.classList.remove('active');
            }, 4000);
        }

        // Download template
        function downloadTemplate() {
            // Create a smaller template for download
            const templateData = participants.slice(0, 10).map(p => ({
                Name: p.Name,
                Email: p.Email,
                Groups: p.Groups.join(', ')
            }));
            
            const worksheet = XLSX.utils.json_to_sheet(templateData);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Group Assignment');
            XLSX.writeFile(workbook, 'group_assignment_template.xlsx');
        }

        // Update groups from participants
        function updateGroupsFromParticipants() {
            // Extract all unique groups from all participants
            const allGroups = participants.flatMap(p => p.Groups);
            groups = [...new Set([...groups, ...allGroups])].sort();
        }

        // Update filtered participants based on search and filters
        function updateFilteredParticipants() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const groupFilter = document.getElementById('groupFilter').value;
            const assignmentFilter = document.getElementById('assignmentFilter').value;
            
            filteredParticipants = participants.filter(participant => {
                // Search filter
                const matchesSearch = !searchTerm || 
                    participant.Name.toLowerCase().includes(searchTerm) ||
                    participant.Email.toLowerCase().includes(searchTerm);
                
                // Group filter
                const matchesGroup = !groupFilter || 
                    (participant.Groups && participant.Groups.includes(groupFilter));
                
                // Assignment filter
                let matchesAssignment = true;
                if (assignmentFilter === 'assigned') {
                    matchesAssignment = participant.Groups && participant.Groups.length > 0;
                } else if (assignmentFilter === 'unassigned') {
                    matchesAssignment = !participant.Groups || participant.Groups.length === 0;
                }
                
                return matchesSearch && matchesGroup && matchesAssignment;
            });
            
            // Update group filter options
            updateGroupFilterOptions();
        }

        // Update group filter dropdown
        function updateGroupFilterOptions() {
            const groupFilter = document.getElementById('groupFilter');
            const currentValue = groupFilter.value;
            
            groupFilter.innerHTML = '<option value="">All Groups</option>';
            groups.forEach(group => {
                const option = document.createElement('option');
                option.value = group;
                option.textContent = group;
                if (group === currentValue) {
                    option.selected = true;
                }
                groupFilter.appendChild(option);
            });
        }

        // Update pagination
        function updatePagination() {
            totalPages = Math.ceil(filteredParticipants.length / pageSize);
            currentPage = Math.min(currentPage, totalPages);
            
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            document.getElementById('firstPage').disabled = currentPage === 1;
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages;
            document.getElementById('lastPage').disabled = currentPage === totalPages;
        }

        // Render current page
        function renderCurrentPage() {
            const tableBody = document.getElementById('assignmentBody');
            tableBody.innerHTML = '';
            
            if (filteredParticipants.length === 0) {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.colSpan = 5;
                td.textContent = 'No participants found matching your criteria';
                td.style.textAlign = 'center';
                td.style.padding = '20px';
                td.style.color = 'var(--gray)';
                tr.appendChild(td);
                tableBody.appendChild(tr);
                return;
            }
            
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, filteredParticipants.length);
            const pageParticipants = filteredParticipants.slice(startIndex, endIndex);
            
            pageParticipants.forEach((participant, index) => {
                const tr = document.createElement('tr');
                
                // Checkbox
                const checkboxTd = document.createElement('td');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'participant-checkbox';
                checkbox.dataset.index = startIndex + index;
                checkboxTd.appendChild(checkbox);
                tr.appendChild(checkboxTd);
                
                // Name
                const nameTd = document.createElement('td');
                nameTd.textContent = participant.Name || 'Unknown';
                tr.appendChild(nameTd);
                
                // Email
                const emailTd = document.createElement('td');
                emailTd.textContent = participant.Email || '';
                tr.appendChild(emailTd);
                
                // Current Groups
                const groupsTd = document.createElement('td');
                if (participant.Groups && participant.Groups.length > 0) {
                    // Show first 2 groups, with +X more if there are more
                    const displayGroups = participant.Groups.slice(0, 2);
                    displayGroups.forEach(group => {
                        const badge = document.createElement('span');
                        badge.className = 'status-badge status-assigned';
                        badge.textContent = group;
                        groupsTd.appendChild(badge);
                    });
                    
                    if (participant.Groups.length > 2) {
                        const moreBadge = document.createElement('span');
                        moreBadge.className = 'status-badge status-assigned';
                        moreBadge.textContent = `+${participant.Groups.length - 2} more`;
                        moreBadge.title = participant.Groups.slice(2).join(', ');
                        groupsTd.appendChild(moreBadge);
                    }
                } else {
                    groupsTd.innerHTML = '<span class="status-badge status-unassigned">Unassigned</span>';
                }
                tr.appendChild(groupsTd);
                
                // Assign Groups
                const assignTd = document.createElement('td');
                const groupSelect = document.createElement('select');
                groupSelect.className = 'group-select multi-select';
                groupSelect.multiple = true;
                groupSelect.size = 3;
                
                groups.forEach(group => {
                    const option = document.createElement('option');
                    option.value = group;
                    option.textContent = group;
                    if (participant.Groups && participant.Groups.includes(group)) {
                        option.selected = true;
                    }
                    groupSelect.appendChild(option);
                });
                
                groupSelect.addEventListener('change', (e) => {
                    const selectedGroups = Array.from(e.target.selectedOptions).map(option => option.value);
                    participant.Groups = selectedGroups;
                    updateGroupsOverview();
                    updateStats();
                });
                
                assignTd.appendChild(groupSelect);
                tr.appendChild(assignTd);
                
                tableBody.appendChild(tr);
            });
        }

        // Go to specific page
        function goToPage(page) {
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                updatePagination();
                renderCurrentPage();
            }
        }

        // Update group select dropdown
        function updateGroupSelect() {
            const existingGroupSelect = document.getElementById('existingGroupSelect');
            const batchGroupSelect = document.getElementById('batchGroupSelect');
            
            existingGroupSelect.innerHTML = '';
            batchGroupSelect.innerHTML = '<option value="">Select groups to assign</option>';
            
            groups.forEach(group => {
                const option1 = document.createElement('option');
                option1.value = group;
                option1.textContent = group;
                existingGroupSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = group;
                option2.textContent = group;
                batchGroupSelect.appendChild(option2);
            });
        }

        // Update groups overview
        function updateGroupsOverview() {
            const groupsOverview = document.getElementById('groupsOverview');
            groupsOverview.innerHTML = '';
            
            // Count participants in each group
            const groupCounts = {};
            groups.forEach(group => {
                groupCounts[group] = participants.filter(p => 
                    p.Groups && p.Groups.includes(group)
                ).length;
            });
            
            // Sort groups by participant count (descending)
            const sortedGroups = [...groups].sort((a, b) => groupCounts[b] - groupCounts[a]);
            
            // Create group cards (limit to top 12 for performance)
            const displayGroups = sortedGroups.slice(0, 12);
            displayGroups.forEach(group => {
                const groupCard = document.createElement('div');
                groupCard.className = 'group-card';
                
                const members = participants.filter(p => 
                    p.Groups && p.Groups.includes(group)
                ).slice(0, 5).map(p => p.Name || 'Unknown'); // Limit to 5 members for performance
                
                groupCard.innerHTML = `
                    <div class="group-header">
                        <div class="group-name">${group}</div>
                        <div class="group-count">${groupCounts[group]}</div>
                    </div>
                    <div class="group-members">
                        ${members.length > 0 ? members.join('<br>') : 'No members'}
                        ${groupCounts[group] > 5 ? `<br>+${groupCounts[group] - 5} more` : ''}
                    </div>
                `;
                groupsOverview.appendChild(groupCard);
            });
            
            // Show message if there are more groups
            if (sortedGroups.length > 12) {
                const moreCard = document.createElement('div');
                moreCard.className = 'group-card';
                moreCard.innerHTML = `
                    <div class="group-header">
                        <div class="group-name">+${sortedGroups.length - 12} More Groups</div>
                    </div>
                    <div class="group-members">
                        Use filters to view other groups
                    </div>
                `;
                groupsOverview.appendChild(moreCard);
            }
        }

        // Update statistics
        function updateStats() {
            const total = participants.length;
            const assigned = participants.filter(p => p.Groups && p.Groups.length > 0).length;
            const unassigned = total - assigned;
            const totalAssignments = participants.reduce((sum, p) => sum + (p.Groups ? p.Groups.length : 0), 0);
            
            document.getElementById('totalParticipants').textContent = total.toLocaleString();
            document.getElementById('assignedParticipants').textContent = assigned.toLocaleString();
            document.getElementById('unassignedParticipants').textContent = unassigned.toLocaleString();
            document.getElementById('totalGroups').textContent = groups.length.toLocaleString();
            document.getElementById('totalAssignments').textContent = totalAssignments.toLocaleString();
            
            document.getElementById('unassignedCount').textContent = `${unassigned} unassigned`;
            document.getElementById('totalAssignmentCount').textContent = `${totalAssignments} assignments`;
        }

        // Create new groups
        function createNewGroups() {
            const newGroupsInput = document.getElementById('newGroupsInput').value;
            if (!newGroupsInput.trim()) {
                showAlert('Please enter group names', 'error');
                return;
            }
            
            const newGroups = newGroupsInput.split(',').map(g => g.trim()).filter(Boolean);
            
            // Add new groups to existing groups
            groups = [...new Set([...groups, ...newGroups])];
            
            updateGroupSelect();
            updateGroupFilterOptions();
            document.getElementById('newGroupsInput').value = '';
            showAlert(`Added ${newGroups.length} new groups`, 'success');
        }

        // Assign selected groups to all
        function assignSelectedGroups() {
            const selectedGroups = Array.from(document.getElementById('existingGroupSelect').selectedOptions)
                .map(option => option.value);
            
            if (selectedGroups.length === 0) {
                showAlert('Please select at least one group', 'error');
                return;
            }
            
            participants.forEach(p => {
                // Add selected groups to each participant (don't remove existing ones)
                p.Groups = [...new Set([...(p.Groups || []), ...selectedGroups])];
            });
            
            updateFilteredParticipants();
            updatePagination();
            renderCurrentPage();
            updateGroupsOverview();
            updateStats();
            showAlert(`Selected groups assigned to all participants`, 'success');
        }

        // Auto assign groups
        function autoAssignGroups() {
            if (groups.length === 0) {
                showAlert('Please create groups first', 'error');
                return;
            }
            
            // Randomly assign 1-3 groups to each participant
            participants.forEach((participant) => {
                const numGroups = Math.floor(Math.random() * 3) + 1; // 1-3 groups
                const shuffledGroups = [...groups].sort(() => 0.5 - Math.random());
                participant.Groups = shuffledGroups.slice(0, numGroups);
            });
            
            updateFilteredParticipants();
            updatePagination();
            renderCurrentPage();
            updateGroupsOverview();
            updateStats();
            showAlert('Participants assigned to groups automatically', 'success');
        }

        // Clear all assignments
        function clearAssignments() {
            if (confirm('Are you sure you want to clear all group assignments?')) {
                participants.forEach(p => {
                    p.Groups = [];
                });
                
                updateFilteredParticipants();
                updatePagination();
                renderCurrentPage();
                updateGroupsOverview();
                updateStats();
                showAlert('All assignments cleared', 'success');
            }
        }

        // Select all unassigned participants
        function selectUnassigned() {
            // Set filter to unassigned
            document.getElementById('assignmentFilter').value = 'unassigned';
            updateFilteredParticipants();
            updatePagination();
            renderCurrentPage();
            
            // Check all checkboxes on current page
            const checkboxes = document.querySelectorAll('.participant-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            
            showAlert('Selected all unassigned participants on this page', 'success');
        }

        // Assign groups to selected participants
        function assignToSelected() {
            const selectedGroups = Array.from(document.getElementById('batchGroupSelect').selectedOptions)
                .map(option => option.value);
            
            if (selectedGroups.length === 0) {
                showAlert('Please select at least one group', 'error');
                return;
            }
            
            const checkboxes = document.querySelectorAll('.participant-checkbox:checked');
            if (checkboxes.length === 0) {
                showAlert('Please select at least one participant', 'error');
                return;
            }
            
            checkboxes.forEach(checkbox => {
                const index = parseInt(checkbox.dataset.index);
                if (filteredParticipants[index]) {
                    const participant = filteredParticipants[index];
                    // Add selected groups to participant (don't remove existing ones)
                    participant.Groups = [...new Set([...(participant.Groups || []), ...selectedGroups])];
                }
            });
            
            updateFilteredParticipants();
            updatePagination();
            renderCurrentPage();
            updateGroupsOverview();
            updateStats();
            showAlert(`Assigned groups to ${checkboxes.length} participants`, 'success');
        }

        // Export to Excel
        function exportToExcel() {
            if (participants.length === 0) {
                showAlert('No data to export', 'error');
                return;
            }
            
            // Convert Groups array to comma-separated string for Excel
            const exportData = participants.map(p => ({
                ...p,
                Groups: p.Groups ? p.Groups.join(', ') : ''
            }));
            
            const worksheet = XLSX.utils.json_to_sheet(exportData);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Group Assignments');
            XLSX.writeFile(workbook, 'group_assignments.xlsx');
        }

        // Initialize the application when the page loads
        window.onload = init;
    </script>